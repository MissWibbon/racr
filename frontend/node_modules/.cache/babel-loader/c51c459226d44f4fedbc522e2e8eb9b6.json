{"ast":null,"code":"/*\n * Copyright (c) 2018 by Filestack.\n * Some rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as tslib_1 from \"tslib\";\nimport { removeEmpty } from '../utils';\nimport { getValidator, PreviewParamsSchema } from './../../schema';\nimport { FilestackError, FilestackErrorType } from './../../filestack_error';\n/**\n * Returns file preview url\n *\n * @private\n * @param session\n * @param handle\n * @param opts\n * @param security\n */\n\nexport var getUrl = function (session, handle, opts, security) {\n  var options = tslib_1.__assign({}, opts);\n\n  var policy = security && security.policy || session.policy;\n  var signature = security && security.signature || session.signature;\n  var hasSecurity = signature && policy;\n  var baseUrl = [session.urls.cdnUrl];\n  var css = options.css && encodeURIComponent(\"\\\"\" + options.css + \"\\\"\");\n  var previewTask = css ? \"preview=css:\" + css : 'preview'; // @todo move to utils?\n\n  if (handle.indexOf('src:') !== -1) {\n    baseUrl.push(session.apikey + \"/\" + previewTask);\n  } else {\n    baseUrl.push(previewTask);\n  }\n\n  if (hasSecurity) {\n    baseUrl.push(\"security=policy:\" + policy + \",signature:\" + signature);\n  }\n\n  baseUrl.push(handle);\n  return baseUrl.join('/');\n};\n/**\n * Appends image preview into page\n *\n * @private\n * @param session\n * @param handle\n * @param opts\n */\n\nexport var preview = function (session, handle, opts) {\n  if (!handle || typeof handle !== 'string') {\n    throw new Error('A valid Filestack handle or storage alias is required for preview');\n  }\n\n  var validateRes = getValidator(PreviewParamsSchema)(opts);\n\n  if (validateRes.errors.length) {\n    throw new FilestackError(\"Invalid preview params\", validateRes.errors, FilestackErrorType.VALIDATION);\n  }\n\n  var options = removeEmpty(opts || {});\n  var url = getUrl(session, handle, options);\n\n  if (options && options.id) {\n    var id = options.id;\n    var iframe = document.createElement('iframe');\n    var domElement = document.getElementById(id);\n    iframe.src = url;\n    iframe.width = '100%';\n    iframe.height = '100%';\n\n    if (!domElement) {\n      throw new Error(\"DOM Element with id \\\"\" + id + \"\\\" not found.\");\n    }\n\n    return domElement.appendChild(iframe);\n  }\n\n  return window.open(url, handle);\n};","map":null,"metadata":{},"sourceType":"module"}