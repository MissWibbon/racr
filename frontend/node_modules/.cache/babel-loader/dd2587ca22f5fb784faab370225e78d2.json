{"ast":null,"code":"/*\n * Copyright (c) 2018 by Filestack\n * Some rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { config } from './../config';\nimport { TransformSchema } from './../schema/transforms.schema';\nimport { getValidator } from './../schema/validator';\nimport { resolveHost, b64 } from './utils';\nimport { FilestackError, FilestackErrorType } from './../filestack_error';\nimport Debug from 'debug';\nvar debug = Debug('fs:filelink');\nexport var Align;\n\n(function (Align) {\n  Align[\"left\"] = \"left\";\n  Align[\"right\"] = \"right\";\n  Align[\"center\"] = \"center\";\n  Align[\"bottom\"] = \"bottom\";\n  Align[\"top\"] = \"top\";\n  Align[\"faces\"] = \"faces\";\n  Align[\"middle\"] = \"middle\";\n})(Align || (Align = {}));\n/**\n * Fit enum\n */\n\n\nexport var FitOptions;\n\n(function (FitOptions) {\n  FitOptions[\"clip\"] = \"clip\";\n  FitOptions[\"crop\"] = \"crop\";\n  FitOptions[\"scale\"] = \"scale\";\n  FitOptions[\"max\"] = \"max\";\n})(FitOptions || (FitOptions = {}));\n/**\n * Blur enum\n */\n\n\nexport var BlurMode;\n\n(function (BlurMode) {\n  BlurMode[\"linear\"] = \"linear\";\n  BlurMode[\"gaussian\"] = \"gaussian\";\n})(BlurMode || (BlurMode = {}));\n/**\n * Shapes enum\n */\n\n\nexport var ShapeType;\n\n(function (ShapeType) {\n  ShapeType[\"oval\"] = \"oval\";\n  ShapeType[\"rect\"] = \"rect\";\n})(ShapeType || (ShapeType = {}));\n/**\n * Noise type enum\n */\n\n\nexport var NoiseType;\n\n(function (NoiseType) {\n  NoiseType[\"none\"] = \"none\";\n  NoiseType[\"low\"] = \"low\";\n  NoiseType[\"medium\"] = \"medium\";\n  NoiseType[\"high\"] = \"high\";\n})(NoiseType || (NoiseType = {}));\n/**\n * Style type enum\n */\n\n\nexport var StyleType;\n\n(function (StyleType) {\n  StyleType[\"artwork\"] = \"artwork\";\n  StyleType[\"photo\"] = \"photo\";\n})(StyleType || (StyleType = {}));\n/**\n * Color space enum\n */\n\n\nexport var ColorspaceType;\n\n(function (ColorspaceType) {\n  ColorspaceType[\"RGB\"] = \"RGB\";\n  ColorspaceType[\"CMYK\"] = \"CMYK\";\n  ColorspaceType[\"Input\"] = \"Input\";\n})(ColorspaceType || (ColorspaceType = {}));\n/**\n * Crop faces options enum\n */\n\n\nexport var CropfacesType;\n\n(function (CropfacesType) {\n  CropfacesType[\"thumb\"] = \"thumb\";\n  CropfacesType[\"crop\"] = \"crop\";\n  CropfacesType[\"fill\"] = \"fill\";\n})(CropfacesType || (CropfacesType = {}));\n/**\n * Convert to format\n */\n\n\nexport var VideoTypes;\n\n(function (VideoTypes) {\n  VideoTypes[\"h264\"] = \"h264\";\n  VideoTypes[\"h264_hi\"] = \"h264.hi\";\n  VideoTypes[\"webm\"] = \"webm\";\n  VideoTypes[\"webm-hi\"] = \"webm.hi\";\n  VideoTypes[\"ogg\"] = \"ogg\";\n  VideoTypes[\"ogg-hi\"] = \"ogg.hi\";\n  VideoTypes[\"hls-variant\"] = \"hls.variant\";\n  VideoTypes[\"mp3\"] = \"mp3\";\n  VideoTypes[\"oga\"] = \"oga\";\n  VideoTypes[\"m4a\"] = \"m4a\";\n  VideoTypes[\"aac\"] = \"aac\";\n  VideoTypes[\"hls\"] = \"hls.variant.audio\";\n})(VideoTypes || (VideoTypes = {}));\n\nexport var URLScreenshotAgent;\n\n(function (URLScreenshotAgent) {\n  URLScreenshotAgent[\"desktop\"] = \"desktop\";\n  URLScreenshotAgent[\"mobile\"] = \"mobile\";\n})(URLScreenshotAgent || (URLScreenshotAgent = {}));\n\nexport var URLScreenshotMode;\n\n(function (URLScreenshotMode) {\n  URLScreenshotMode[\"all\"] = \"all\";\n  URLScreenshotMode[\"window\"] = \"window\";\n})(URLScreenshotMode || (URLScreenshotMode = {}));\n\nexport var URLScreenshotOrientation;\n\n(function (URLScreenshotOrientation) {\n  URLScreenshotOrientation[\"portrait\"] = \"portrait\";\n  URLScreenshotOrientation[\"landscape\"] = \"landscape\";\n})(URLScreenshotOrientation || (URLScreenshotOrientation = {}));\n/**\n * Video storage location\n */\n\n\nexport var Locations;\n\n(function (Locations) {\n  Locations[\"s3\"] = \"s3\";\n  Locations[\"azure\"] = \"azure\";\n  Locations[\"gcs\"] = \"gcs\";\n  Locations[\"rackspace\"] = \"rackspace\";\n  Locations[\"dropbox\"] = \"dropbox\";\n})(Locations || (Locations = {}));\n\nexport var VideoAccess;\n\n(function (VideoAccess) {\n  VideoAccess[\"private\"] = \"private\";\n  VideoAccess[\"public\"] = \"public\";\n})(VideoAccess || (VideoAccess = {}));\n\nexport var VideoAccessMode;\n\n(function (VideoAccessMode) {\n  VideoAccessMode[\"preserve\"] = \"preserve\";\n  VideoAccessMode[\"constrain\"] = \"constrain\";\n  VideoAccessMode[\"letterbox\"] = \"letterbox\";\n  VideoAccessMode[\"pad\"] = \"pad\";\n  VideoAccessMode[\"crop\"] = \"crop\";\n})(VideoAccessMode || (VideoAccessMode = {}));\n\nexport var EnhancePreset;\n\n(function (EnhancePreset) {\n  EnhancePreset[\"auto\"] = \"auto\";\n  EnhancePreset[\"vivid\"] = \"vivid\";\n  EnhancePreset[\"beautify\"] = \"beautify\";\n  EnhancePreset[\"beautifyPlus\"] = \"beautify_plus\";\n  EnhancePreset[\"fixDark\"] = \"fix_dark\";\n  EnhancePreset[\"fixNoise\"] = \"fix_noise\";\n  EnhancePreset[\"fixTint\"] = \"fix_tint\";\n  EnhancePreset[\"outdor\"] = \"outdoor\";\n  EnhancePreset[\"fireworks\"] = \"fireworks\";\n})(EnhancePreset || (EnhancePreset = {}));\n\nvar handleRegexp = /^[\\w\\-]{20}$/;\n/**\n * Class for handling filelinks. For now its supports all filestack transforms.\n * It outputs transform url or array of transforms\n * @example\n * const link = new Filelink('handle or externalUrl', 'apikey');\n * link.flip().flop().store();\n *\n * console.log(link.toString());\n * // enable base64 support\n * link.setBase64(true)\n *\n * console.log(link.toString());\n *\n * @export\n * @class Filelink\n */\n\nvar Filelink =\n/** @class */\nfunction () {\n  /**\n   * Class for generating tranformation urls\n   * @param {(string | string[])} source - handle or multiple handles (i.e. for collage)\n   * @param {string} [apikey] - your apikey - required for all external sources\n   *\n   * @memberof Filelink\n   */\n  function Filelink(source, apikey) {\n    /**\n     * Applied transforms array\n     *\n     * @private\n     * @memberof Filelink\n     */\n    this.transforms = [];\n    /**\n     * Is base64 support is enabled\n     *\n     * @private\n     * @type {boolean}\n     * @memberof Filelink\n     */\n\n    this.b64 = false;\n    /**\n     * should use a validator to check params of every task\n     * @private\n     * @type {boolean}\n     * @memberof Filelink\n     */\n\n    this.useValidator = true;\n    /**\n     * Converts array of objects to object\n     *\n     * @private\n     * @example [{name: 'resize', params: {height: 125}}] => {resize: {height: 125}}\n     * @param arr - any array\n     */\n\n    this.arrayToObject = function (array, nameKey, dataKey) {\n      return array.reduce(function (obj, item) {\n        obj[item[nameKey]] = item[dataKey];\n        return obj;\n      }, {});\n    };\n\n    this.apikey = apikey;\n    this.setSource(source);\n  }\n  /**\n   * Enable new base64 link support to avoid problems with special chars in link\n   *\n   * @param {boolean} flag\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.setBase64 = function (flag) {\n    this.b64 = flag;\n    return this;\n  };\n  /**\n   * Switch the useValidator flag\n   *\n   * @param {boolean} flag\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.setUseValidator = function (flag) {\n    this.useValidator = flag;\n    return this;\n  };\n  /**\n   * Set cname for transformation link\n   *\n   * @param {string} cname\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.setCname = function (cname) {\n    this.cname = cname;\n    return this;\n  };\n  /**\n   * Set custom domain. Used for test purpose. It will be removed when after client.transform\n   *\n   * @param {string} domain\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.setCustomDomain = function (domain) {\n    this.customDomain = domain;\n    return this;\n  };\n\n  Filelink.prototype.setSource = function (source) {\n    this.source = source;\n    var isExternal = this.isSourceExternal();\n    debug(\"Source \" + source + \" - isExternal? \" + isExternal);\n\n    if (isExternal && !this.apikey) {\n      throw new FilestackError('External sources requires apikey to handle transforms');\n    }\n\n    if (!isExternal && typeof this.source === 'string' && !handleRegexp.test(this.source) && this.source.indexOf('filestackcontent') === -1) {\n      throw new FilestackError('Invalid filestack source provided');\n    }\n  };\n  /**\n   * Returns JSONSchema form transformations params\n   *\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.getValidationSchema = function () {\n    return TransformSchema;\n  };\n  /**\n   * Returns transformations in JSON format\n   *\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.getTransformations = function () {\n    if (this.useValidator) {\n      this.validateTasks(this.transforms);\n    }\n\n    return this.transforms;\n  };\n  /**\n   * Returns transform url\n   *\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.toString = function () {\n    var returnUrl = [];\n    returnUrl.push(this.getCdnHost());\n\n    if (this.useValidator) {\n      this.validateTasks(this.transforms);\n    }\n\n    if (this.apikey) {\n      returnUrl.push(this.apikey);\n    }\n\n    var transformsString = this.generateTransformString();\n    var source = this.source;\n\n    if (this.b64) {\n      if (this.transforms.length > 0) {\n        transformsString = \"b64/\" + b64(JSON.stringify(this.transforms), true);\n      }\n\n      if (Array.isArray(source)) {\n        source = this.arrayToString(source);\n      }\n\n      source = \"b64://\" + b64(source, true);\n    } else {\n      if (Array.isArray(source)) {\n        source = this.arrayToString(source);\n      } else {\n        source = this.escapeValue(source);\n      }\n    }\n\n    if (transformsString.length) {\n      returnUrl.push(transformsString);\n    }\n\n    returnUrl.push(source);\n    return returnUrl.join('/');\n  };\n  /**\n   * Add task and validate\n   *\n   * @param {string} name\n   * @param {*} [params]\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.addTask = function (name, params) {\n    Debug(\"Add task  \" + name + \" with params %O\", params);\n\n    if (name !== 'cache' && typeof params === 'boolean') {\n      if (!params) {\n        return this;\n      } else {\n        params = undefined;\n      }\n    } else if (typeof params === 'object' && !Object.keys(params).length) {\n      params = undefined;\n    }\n\n    this.transforms.push({\n      name: name,\n      params: params\n    });\n    return this;\n  };\n  /**\n   * Cleanup transformations on filelink\n   *\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.reset = function () {\n    this.transforms = [];\n    return this;\n  };\n  /**\n   * Transformations part\n   */\n\n  /**\n   * Add autoimage transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#auto-image-conversion\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.autoImage = function () {\n    return this.addTask('auto_image', true);\n  };\n  /**\n   * Adds flip transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#flip\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.flip = function () {\n    return this.addTask('flip', true);\n  };\n  /**\n   * Adds flop transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#flop\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.flop = function () {\n    return this.addTask('flop', true);\n  };\n  /**\n   * Adds enhance transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#enhance\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.enhance = function (params) {\n    return this.addTask('enhance', params || true);\n  };\n  /**\n   * Add security to link\n   *\n   * @see https://www.filestack.com/docs/api/processing/#redeye\n   * @returns\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.redeye = function () {\n    return this.addTask('redeye', true);\n  };\n  /**\n   * Add monochrome transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#monochrome\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.monochrome = function () {\n    return this.addTask('monochrome', true);\n  };\n  /**\n   * Add compress transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#compress\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.compress = function (params) {\n    return this.addTask('compress', params || true);\n  };\n  /**\n   * Adds negative transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#negative\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.negative = function () {\n    return this.addTask('negative', true);\n  };\n  /**\n   * Adds tags transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#tags\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.tags = function () {\n    return this.addTask('tags', true);\n  };\n  /**\n   * Adds sfw transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#sfw\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.sfw = function () {\n    return this.addTask('sfw', true);\n  };\n  /**\n   * Add animate transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#animate-images-to-gif\n   * @param params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.animate = function (params) {\n    return this.addTask('animate', params);\n  };\n  /**\n   * Adds store transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#store\n   * @param {(StoreParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.store = function (params) {\n    return this.addTask('store', params);\n  };\n  /**\n   * Adds cache transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#cache\n   * @param {(CacheParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.cache = function (params) {\n    return this.addTask('cache', params);\n  };\n  /**\n   * Adds resize transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#resize\n   * @param {ResizeParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.resize = function (params) {\n    return this.addTask('resize', params);\n  };\n  /**\n   * Adds crop transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#crop\n   * @param {CropParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.crop = function (params) {\n    return this.addTask('crop', params);\n  };\n  /**\n   * Adds rotate transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#rotate\n   * @param {RotateParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.rotate = function (params) {\n    return this.addTask('rotate', params);\n  };\n  /**\n   * Adds detect_faces transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#facial-detection\n   * @param {(DetectFacesParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.detectFaces = function (params) {\n    return this.addTask('detect_faces', params);\n  };\n  /**\n   * Adds crop faces transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#crop-faces\n   * @param {CropFacesParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.cropFaces = function (params) {\n    return this.addTask('crop_faces', params);\n  };\n  /**\n   * Adds pixelate faces transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#pixelate-faces\n   * @param {PixelateFacesParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.pixelateFaces = function (params) {\n    return this.addTask('pixelate_faces', params);\n  };\n  /**\n   * Adds blur faces transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#blur-faces\n   * @param {BlurFacesParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.blurFaces = function (params) {\n    return this.addTask('blur_faces', params);\n  };\n  /**\n   * Adds rounded corners transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#rounded-corners\n   * @param {(RoundedCornersParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.roundedCorners = function (params) {\n    return this.addTask('rounded_corners', params);\n  };\n  /**\n   * Adds polaroid transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#polaroid\n   * @param {(PolaroidParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.polaroid = function (params) {\n    return this.addTask('polaroid', params);\n  };\n  /**\n   * Adds vignette transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#vignette\n   * @param {(VignetteParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.vignette = function (params) {\n    return this.addTask('vignette', params);\n  };\n  /**\n   * Adds torn edges transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#torn-edges\n   * @param {(TornEdgesParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.tornEdges = function (params) {\n    return this.addTask('torn_edges', params);\n  };\n  /**\n   * Adds shadow transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#shadow\n   * @param {(ShadowParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.shadow = function (params) {\n    return this.addTask('shadow', params);\n  };\n  /**\n   * Adds circle transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#circle\n   * @param {(CircleParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.circle = function (params) {\n    return this.addTask('circle', params);\n  };\n  /**\n   * Adds border transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#border\n   * @param {(BorderParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.border = function (params) {\n    return this.addTask('border', params);\n  };\n  /**\n   * Adds sharpen transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#sharpen\n   * @param {(SharpenParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.sharpen = function (params) {\n    return this.addTask('sharpen', params);\n  };\n  /**\n   * Adds blur transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#blur\n   * @param {(BlurParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.blur = function (params) {\n    return this.addTask('blur', params);\n  };\n  /**\n   * Adds blackwhite transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#blackwhite\n   * @param {(BlackwhiteParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.blackwhite = function (params) {\n    return this.addTask('blackwhite', params);\n  };\n  /**\n   * Adds sepia transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#sepia\n   * @param {(SepiaParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.sepia = function (params) {\n    return this.addTask('sepia', params);\n  };\n  /**\n   * Adds pixelate transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#pixelate\n   * @param {(PixelateParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.pixelate = function (params) {\n    return this.addTask('pixelate', params);\n  };\n  /**\n   * Adds oilpaint transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#oil-paint\n   * @param {(OilPaintParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.oilPaint = function (params) {\n    return this.addTask('oil_paint', params);\n  };\n  /**\n   * Adds modulate transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#modulate\n   * @param {(ModulateParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.modulate = function (params) {\n    return this.addTask('modulate', params);\n  };\n  /**\n   * Adds partial pixelate transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#partial-pixelate\n   * @param {PartialPixelateParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.partialPixelate = function (params) {\n    return this.addTask('partial_pixelate', params);\n  };\n  /**\n   * Adds partial blur transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#partial-blur\n   * @param {PartialBlurParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.partialBlur = function (params) {\n    return this.addTask('partial_blur', params);\n  };\n  /**\n   * Adds collage transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#collage\n   * @param {CollageParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.collage = function (params) {\n    return this.addTask('collage', params);\n  };\n  /**\n   * Adds upscale transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#upscale\n   * @param {(UpscaleParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.upscale = function (params) {\n    return this.addTask('upscale', params);\n  };\n  /**\n   * Adds ascii transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#ascii\n   * @param {(AsciiParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.ascii = function (params) {\n    return this.addTask('ascii', params);\n  };\n  /**\n   * Adds quality transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#quality\n   * @param {QualityParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.quality = function (params) {\n    return this.addTask('quality', params);\n  };\n  /**\n   * Adds security transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#security\n   * @param {SecurityParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.security = function (params) {\n    return this.addTask('security', params);\n  };\n  /**\n   * Adds output transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#output\n   * @param {OutputParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.output = function (params) {\n    return this.addTask('output', params);\n  };\n  /**\n   * Adds video convert transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#video-convert\n   * @param {VideoConvertParams} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.videoConvert = function (params) {\n    return this.addTask('video_convert', params);\n  };\n  /**\n   * Adds URLScreenshot transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#urlscreenshot\n   * @param {(URLScreenshotParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.URLScreenshot = function (params) {\n    return this.addTask('urlscreenshot', params);\n  };\n  /**\n   * Adds pdfinfo transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#pdfinfo\n   * @param {(PdfInfoParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.PDFInfo = function (params) {\n    return this.addTask('pdfinfo', params);\n  };\n  /**\n   * Adds pdfconvert transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#pdfconvert\n   * @param {(PdfConvertParams | boolean)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.PDFConvert = function (params) {\n    return this.addTask('pdfconvert', params);\n  };\n  /**\n   * Adds fallback transformation\n   *\n   * @see https://www.filestack.com/docs/api/processing/#fallback\n   * @param {(FallbackParams)} params\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.fallback = function (params) {\n    return this.addTask('fallback', params);\n  };\n  /**\n   * Add zip transformation which create a zip package on files\n   * used on actual context\n   *\n   * @see https://www.filestack.com/docs/api/processing/#zip\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.zip = function () {\n    return this.addTask('zip', true);\n  };\n  /**\n   * Add task which minify a css file\n   *\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.minifyCss = function (params) {\n    return this.addTask('minify_css', params);\n  };\n  /**\n   * Add task which minify a javascript file.\n   * For better handling of 'targets' param, use with b64 flag enabled.\n   *\n   * @returns this\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.minifyJs = function (params) {\n    return this.addTask('minify_js', params);\n  };\n  /**\n   * Checks if source is external\n   *\n   * @private\n   * @returns {boolean}\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.isSourceExternal = function () {\n    if (!this.source) {\n      throw new FilestackError('Source not Set');\n    }\n\n    var toTest = Array.isArray(this.source) ? this.source : [this.source];\n\n    for (var i in toTest) {\n      /* istanbul ignore next */\n      if (!toTest.hasOwnProperty(i)) {\n        continue;\n      }\n\n      if (toTest[i].indexOf('src:') === 0 || toTest[i].indexOf('http') === 0 && toTest[i].indexOf('filestackcontent') === -1) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n  /**\n   * Validate every task against schema\n   *\n   * @private\n   * @param {object[]} transformations - object which contain all transformations\n   * @returns {void}\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.validateTasks = function (transformations) {\n    var res = Filelink.validator(this.arrayToObject(transformations, 'name', 'params'));\n\n    if (res.errors.length) {\n      throw new FilestackError(\"Params validation error\", res.errors, FilestackErrorType.VALIDATION);\n    }\n\n    return;\n  };\n  /**\n   * Returns correct cdn url with cname support\n   *\n   * @private\n   * @returns {string}\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.getCdnHost = function () {\n    var urls = config.urls;\n\n    if (this.customDomain) {\n      urls.cdnUrl = this.customDomain;\n    }\n\n    urls = resolveHost(urls, this.cname);\n    return urls.cdnUrl;\n  };\n  /**\n   * Returns applied transformations as string\n   *\n   * @private\n   * @returns {string}\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.generateTransformString = function () {\n    var _this = this;\n\n    var transforms = [];\n    this.transforms.forEach(function (el) {\n      transforms.push(_this.optionToString(el.name, el.params));\n    });\n    return transforms.join('/');\n  };\n  /**\n   * Flatten transformation option to string\n   *\n   * @private\n   * @example {resize:{width: 100,height: 200}} => resize=width:100,height:200\n   * @param key - option key\n   * @param values - option params\n   */\n\n\n  Filelink.prototype.optionToString = function (key, values) {\n    var _this = this;\n\n    var optionsString = [];\n\n    if (typeof values === 'undefined') {\n      return key;\n    } // if we just want to enable feature\n\n\n    if (typeof values === 'boolean') {\n      if (!values && key === 'cache') {\n        return 'cache=false';\n      }\n\n      return key;\n    }\n\n    Object.keys(values).forEach(function (i) {\n      if (Array.isArray(values[i])) {\n        optionsString.push(i + \":\" + _this.arrayToString(values[i]));\n        return;\n      }\n\n      optionsString.push(i + \":\" + _this.escapeValue(values[i]));\n    });\n    return key + \"=\" + optionsString.join(',');\n  };\n  /**\n   * Escape params values\n   *\n   * @private\n   * @param {string} value\n   * @returns {string}\n   * @memberof Filelink\n   */\n\n\n  Filelink.prototype.escapeValue = function (value) {\n    if (typeof value !== 'string') {\n      return value;\n    }\n\n    if (value.indexOf('/') > -1 || value.indexOf(',') > -1) {\n      return \"\\\"\" + value + \"\\\"\";\n    }\n\n    return value;\n  };\n  /**\n   * Converts nested arrays to string\n   *\n   * @private\n   * @example [1,2, [2,3]] => \"[1,2, [2,3]]\"\n   * @param arr - any array\n   */\n\n\n  Filelink.prototype.arrayToString = function (arr) {\n    var _this = this;\n\n    var toReturn = arr.map(function (el) {\n      if (Array.isArray(el)) {\n        return _this.arrayToString(el);\n      }\n\n      return _this.escapeValue(el);\n    });\n    return \"[\" + toReturn + \"]\";\n  };\n  /**\n   * Validator instance\n   *\n   * @private\n   * @memberof Filelink\n   */\n\n\n  Filelink.validator = getValidator(TransformSchema);\n  return Filelink;\n}();\n\nexport { Filelink };","map":null,"metadata":{},"sourceType":"module"}